# バックテスト方法と評価基準について

## バックテスト方法

まずは、記号を設定する。

- $t \in \{0, 1, \cdots, N \}$ : 時刻（離散時点で考える）
- $S_t = (S^1_t, S^2_t, \cdots, S^m_t)^\top$ : 時刻$t$における投資対象資産の価格
- $R_t = (R^1_t, R^2_t, \cdots, R^m_t)^\top$, $t \in \{1,\cdots, N\}$
    -  $R^i_t=\dfrac{S^i_{t} - S^i_{t-1}}{S^i_{t-1}}$ : 資産$i$のリターン
- $w_t = (w^1_t, w^2_t, \cdots, w^m_t)^\top$ : ポートフォリオ・ウェイト
    - $w^i_t$ : 期間$[t-1, t]$で保有する資産$i$のポートフォリオ・ウェイト ($t \in \{1,2,\cdots,N\}$)
    - $\displaystyle \sum_i w^i_t = 1$ を仮定
- $V_t^w$ : ポートフォリオ $w$ で投資した場合の時刻$t$における時価

バックテストとは資産価格を既知として、与えられたポートフォリオ$w$の各時刻における時価$V_t$を求めることである。

初期投資額は自分で設定するものなので、$V_0$は既知である。
次の時刻$t=1$までは　ポートフォリオ・ウェイト $w_1$ で投資を行うため、
- 資産$i$への投資額は $V_0w^i_1$
- 資産$i$の保有枚数は $\dfrac{V_0w^i_1}{S^i_0}$

従って時刻$t=1$におけるポートフォリオの価値 $V_1$ は
$$ V_1 = \sum_{i=1}^m \dfrac{V_0w^i_1}{S^i_0} S^i_1
   = \sum_{i=1}^m \dfrac{V_0w^i_1}{S^i_0} (1+R^i_1)S^i_0
     = \sum_{i=1}^m V_0 w^i_1 (1+R^i_1) $$
整理して
$$
V_1 = V_0 \left( 1 + \sum_{i=1}^m w^i_1 R^i_1 \right) = V_0 (1+w_1^\top R_1)
$$
である。同様に考えれば
$$
    V_t = V_{t-1} (1+w_t^\top R_t), \quad t \in \{1,2,\cdots,N \}
$$
である。よって、上の式から各時点でのポートフォリオ価値を順に求めればよい。



## リスク調整後リターンとソルティノレシオ

リスク調整後リターン $SR$ は各時点でのポートフォリオ・リターンの標本平均と標本分散で定義する。
$$
\begin{align*}
& \mu_{V^w} := \frac{1}{N} \sum_{t=1}^N \frac{V_t - V_{t-1}}{V_{t-1}} = \frac{1}{N} \sum_{t=1}^N w_t^\top R_t \\
& \sigma_{V^w}^2 := \frac{1}{N-1} \sum_{t=1}^N (w_t^\top R_t - \mu_{V^w})^2 \\
& SR := \frac{\mu_{V^w}}{\sigma_{V^w}}
\end{align*}
$$
端的にいえば、リスク調整後リターンはポートフォリオのリターンをリスクで割ったものである。
同じリターンのポートフォリオならば、リスクが大きいほうがリスク調整後リターンは小さくなる。
従って、リスクとリターンの効率性を見ることができる。

同様の考え方に基づいた指標として、シャープレシオがあった。
実際、リスク調整後リターンはシャープレシオに含まれる無リスク金利を0とした場合とみなせるため
バックテストにおけるシャープレシオとも呼ばれる場合がある。
しかし、定義の仕方が異なるため、リスク調整後リターンと呼ぶ方が無難である。


ソルティレシオ $SR^-$ とはリスク調整後リターンにおける分散を下方半分散に置き換えたものである。
これは、リターンの上振れはリスクと見做さない方法の一つである。

$$
\begin{align*}
& (\sigma_{V^w}^-)^2 := \frac{1}{N-1} \sum_{t=1}^N (w_t^\top R_t - \mu_{V^w})_+^2 \\
& SR^- := \frac{\mu_{V^w}}{\sigma_{V^w}^-}
\end{align*}
$$

